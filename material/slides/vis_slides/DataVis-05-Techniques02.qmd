---
title: "Practical Data Visualization"
author: "Venustiano Soancatl Aguilar"
format: 
  revealjs:
    self-contained: true
---

## Content

- Parallel coordinates
- Heatmaps
- Scatter plots
- Projections
- Biplots
- Treemaps


```{r}
# getwd()

library(reticulate)
use_python("/opt/conda/bin/python", required = TRUE)
```

---

## Parallel coordinates design {.smaller}

![](./images/parallel_coordinates_expl.png){fig-align="center"}

:::: {.columns }
::: {.column width="50%"}
- `row`: horizontal line
- `column`: vertical line
- `column-column correlation`: not easy to see
:::
::: {.column width="50%"}
- `row`: skewed polyline
- `column`: vertical line (permuted values)
- `column-column correlation`: easy to see
:::
::::

---

## Parallel coordinates in plotly {.smaller}

```{.python}
wideTable["older"] = wideTable["older"].astype(int)           # exergame_parallel.ipynb
fig = px.parallel_coordinates(wideTable[wideTable.columns[5:]],color='older')
```

```{python}
import pandas as pd
import plotly.express as px
wideTable = pd.read_csv("../../data/exergamewf.csv")
# https://plotly.com/python/colorscales/
wideTable["older"] = wideTable["older"].astype(int)
fig = px.parallel_coordinates(wideTable[wideTable.columns[5:]],color='older')
# fig.update_layout(autosize=False,width=800,height=400)
fig.show()  
```

- Highlight all rows (lines) passing through selection
- Drag and drop axis horizontally


---

## Parallel coordinates (ggplot)

```{r}
#| echo: true
#| code-line-numbers: "4-6"
library(ggplot2)
library(data.table)
longTable = fread('../../data/exergamelf2.csv')
ggplot(data=longTable,aes(x=myVars,y=normVal)) +
    geom_line(aes(group=idrow,colour=older),alpha=0.5) +
    theme_bw()
```

---

## Density based parallel coordinates

![](./images/Density_Based_Parallel_coordinates.png){fig-align="center" height="500px"}

::: aside
Source: [Visualization Techniques for Parallel
Coordinates](https://elib.uni-stuttgart.de/bitstream/11682/6450/1/Thesis_JH_20130712_electronic_downsampled_web.pdf)
:::

---

## Bundled parallel coordinates

![](./images/Bundled_parallel_coordinates.png){fig-align="center" height="500px"}

::: aside
Source: [Visualization Techniques for Parallel
Coordinates](https://elib.uni-stuttgart.de/bitstream/11682/6450/1/Thesis_JH_20130712_electronic_downsampled_web.pdf)
:::


---

## Heatmap 

- A heatmap displays a matrix of values as colored tiles.
- Each tile can be as small as a pixel.
- Typically: x = horizontal variable, y = vertical variable, color = intensity/value (z).
- Limited by the size/resolution of the screen.
- Color-shading functions are very sensitive to outliers.
- Useful for showing density, correlations, spatiotemporal intensity, and aggregated summaries.

---

## Measles heatmap source code {.smaller}

[Battling Infectious Diseases](https://graphics.wsj.com/infectious-diseases-and-vaccines/)

```{python}
#| echo: true
#| code-line-numbers: "8-11"

import pandas as pd
import plotly.graph_objects as go

longTable = pd.read_csv('../../data/measlesCleaned.csv')
longTable = longTable[longTable.year > 1920]
# longTable.head()

fig = go.Figure(data=go.Heatmap(
        z=longTable['Measles_pop'],
        x=longTable['year'],
        y=longTable['State_Name'],
        xgap=2,
        ygap=2,
        colorscale=['#ddebf8','#0c9dc5','#44ae57','#fcd43d','#e59e26','#e48925','#e95034','#da4b31','#cf472e']));

fig.update_layout(
    # title='',
    # xaxis_nticks=40,
    autosize=False,width=1000,height=900);

```

::: aside
Source code: `Measles_heatmap.ipynb`
:::

---

## Measles heatmap {.scrollable}
```{python}
fig.show()
```

---

## Shaded matrix from Loua (1873) {.smaller}

Summary of 40 separate maps of Paris showing 20 districts.

![](./images/Shaded_matrix_display_Loua%20_1873..png){fig-align="center" height="500px"}

::: aside
Source: The history of the cluster heatmap. Wilkinson and Friendly (2009).
:::

---

## Scatterplots

- Show the relationship between two variables
- Can be used to visualize clusters
- Can be used to create matrix scatterplots
  -  Works fine for a limited number of variables

---

## Speed vs. Curvature

```{python}
#| echo: true
#| code-line-numbers: "10-17"

import pandas as pd
import plotly.express as px

df = pd.read_csv('../../data/exergamewf.csv')

# Ensure 'older' is categorical so Plotly uses distinct symbols
df['older'] = df['older'].astype(str)
df['Age'] = pd.to_numeric(df['Age'], errors='coerce')


# Create scatter plot
fig = px.scatter(
    df,
    x='meanK',
    y='medSpeed',
    color='Age',          # continuous color; use discrete colormap if Age is categorical
    symbol='older',       # different marker shapes per category in 'older'
    height=500,
    hover_data=['iSubj', 'trial'],  # optional extra hover info (adjust to your columns)
    color_continuous_scale='viridis', # or 'magma', 'plasma', etc.
    labels={'meanK': 'K', 'medSpeed': 'Speed', 'Age': 'Age', 'older': 'older'},
)

fig.update_traces(marker=dict(size=8, opacity=0.85));
fig.update_layout(template='plotly_white', legend_title_text='older');
```

---

## Speed vs. Curvature

```{python}
fig.show()
```

---

## Matrix scatterplot

![](./images/matrix_scatterplot.png){fig-align="center"}

## Enhanced matrix scatterplot

![](./images/matrix_scatterplot_improved.png){fig-align="center"}

---

## Projections

- a row represents an n-dimensional point,
- a row can be represented/mapped as a 2D point
- point-to-point distance (in 2D) shows similarity of table rows (in nD)
- coloring points by one attribute can show groups

## Projections

![](./images/projections.png){fig-align="center"}

---

## PCA projection in R

```{r}
#| echo: true
library(ggfortify)

wtable <- read.csv("../../data/exergamewf.csv")

# pca
tpca <- prcomp(wtable[,5:15],scale=TRUE)

# plot
fig <- autoplot(tpca, data = wtable, colour = 'older',
                loadings = TRUE, loadings.colour = 'blue',
     	        loadings.label = TRUE, 
                loadings.label.size = 5
                ) +
	theme_bw()
```

---

## PCA projection

```{r}
print(fig)
```

---

## Treemaps

- A space-filling visualization that represents a `hierarchy` as nested rectangles.  
- Each rectangle's area encodes a quantitative value (part â†’ whole).
- Color encodes a second variable (categorical or continuous).
- Labels identify nodes; interaction (hover/zoom) helps reading details.

## Anatomy of a treemap

- `Root`: full slide area (single root or implicit "all").
- `Branches`: nested rectangles for hierarchical levels (path argument).
- `Leaves`: final rectangles sized by the chosen numeric value.
- `Color`: additional metric (e.g., rate, average) mapped to a color scale.

## A pet shop treemap

![](./images/pet_shop_treemap.png){fig-align="center"}

::: aside
Source: [Datavizcatalogue](https://datavizcatalogue.com/methods/treemap.html)
:::



---

## Visualizing the exergame data as a treemap

```{python, engine="python"}
#| echo: true
#| eval: true

# Importing the packages
import plotly.express as px
import pandas as pd
# Loading and displaying the data
tableRes = pd.read_csv('../../data/exergamewf.csv')

tableRes["Participants"] = "Participants" # in order to have a single root node
tableRes.head()

```
---

## Treemap source code

```{python}
#| echo: true

fig = px.treemap(tableRes, 
                    path=['Participants', 'iSubj', 'trial'], 
                    values='Age', 
                    color='medSpeed', 
                    color_continuous_scale=['#d7191c','#fdae61','#ffffbf','#abd9e9','#2c7bb6'] 
                )
                
fig.update_layout(
                    autosize=False,
                    width=1000,
                    height=600
                );
```

---
### Treemap showing speed values per participant
```{python}
#| echo: true

fig.show()
```
